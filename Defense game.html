<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Defense Game</title>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <script type="text/javascript">
  var bullet_DNA={
    hp:[1,1],
    speed:[3,3],
    size:[10,8]
  }
  var bullet={
    hp:[],
    x:[],
    y:[],
    D:[],
    type:[],
    TargetLocation:[],
    target:[]
  }
  var enemy_DNA={
    hp:[1,2,3,4],
    speed:[1,1,1,1],
    shape:[0,0,0,0], //0:원,1:사각형
    size:[15,15,15,15]
  };
  var tower_DNA={
    R:[100,75],
    cost:[150,250],
    Delay:[100,30]
  };
  var enemy={
    hp:[],
    type:[],
    D:[],
    point:[],
    point_Saver:[],
    x:[],
    y:[]
  };
  var tower={
    type:[],
    Upgrade:[],
    D:[],
    R:[],
    AttackDelay:[],
    x:[],
    y:[]
  };
  var map={
    start:500,
    point:[115,400,115,400,115,400,115,400,115,500],
    Devent:[90,0,90,180,90,0,90,180,90,0],
    pointLocationSaver:[]
  };
  var mouse={
    x:0,
    y:0,
    click:0
  };
  var money=300;
  var Situation=0;
  var Timer=0;
  var HP=100;
  var Select=-1;
  SelectedTower=-1;
  window.addEventListener('mousemove',function(e){
    mouse.x=e.x;
    mouse.y=e.y;
  });
  $(document).click(function (evt) {
    mouse.click=1;
  })
  function draw(){
    var canvas = document.getElementById("MAIN");
    if(canvas.getContext){
      var ctx = canvas.getContext("2d");
      BG();
      switch (Situation) {
        case 0:
          Start();
          break;
        case 1:
          Timer+=1;
          DrawPath();
          InGame();
          for (var i = 0; i < tower.AttackDelay.length; i++) {
            if (tower.AttackDelay[i]!=0) {
              tower.AttackDelay[i]-=1;
            }
          }
          break;
      }
      requestAnimationFrame(draw);
    }
    mouse.click=0;
  }
  function DrawTower(type,upgrade,x,y,size,direction){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.beginPath();
    ctx.fillStyle="#606060";
    ctx.fillRect(x-size/2,y-size/2,size,size);
    ctx.stroke();
    ctx.beginPath();
    ctx.lineWidth=3*(size/50);
    ctx.strokeStyle="#202020";
    ctx.rect(x-size/2,y-size/2,size,size);
    ctx.stroke();
    switch(type){
      case 0:
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-(size/10);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10),y+Math.sin(Math.PI/180*(direction-90))*(size-size/10));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-(size/5);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)),y+Math.sin(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)));
        ctx.stroke();
        ctx.lineWidth=3*(size/50);
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.arc(x,y,size/2-(5*size/50),0,Math.PI * 2);
        ctx.fillStyle = "#6060FF";
        ctx.fill();
        ctx.stroke();
        break;
      case 1:
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        Size=size/10;
        ctx.lineWidth=size/2-Size/2;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size-Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/15)-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/15)-Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-(Size/2);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size+Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/15)+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/15)+Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-Size;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size-Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10)-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/10)-Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-(Size);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size+Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10)+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/10)+Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-size/15;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size,y+Math.sin(Math.PI/180*(direction-90))*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*size*1,y+Math.sin(Math.PI/180*(direction-90))*size*1);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-8*size/50;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*size/5,y+Math.sin(Math.PI/180*(direction-90))*size/5);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size*1-(-size/15+8*size/50)/2),y+Math.sin(Math.PI/180*(direction-90))*(size*1-(-size/15+8*size/50)/2));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.fillStyle = "#6060FF";
        ctx.lineWidth=3*(size/50);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-45))*size/2,y+Math.sin(Math.PI/180*(direction-45))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+45))*size/2,y+Math.sin(Math.PI/180*(direction+45))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+135))*size/2,y+Math.sin(Math.PI/180*(direction+135))*size/2);
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction+135))*size/2,y+Math.sin(Math.PI/180*(direction+135))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+225))*size/2,y+Math.sin(Math.PI/180*(direction+225))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+315))*size/2,y+Math.sin(Math.PI/180*(direction+315))*size/2);
        ctx.fill();
        ctx.stroke();
        break;
    }
  }
  function DrawPath() {
    var ctx = document.getElementById("MAIN").getContext("2d");
    drawer={
      direction:90,
      x:0,
      y:map.start
    };
    ctx.lineWidth=40;
    ctx.strokeStyle="#868e96";
    ctx.beginPath();
    ctx.strokeStyle="#868e96";
    ctx.moveTo(0,drawer.y);
    ctx.stroke();
    map.pointLocationSaver=[];
    for (var i = 0; i < map.point.length; i++) {
      ctx.beginPath();
      drawer.direction=map.Devent[i];
      map.pointLocationSaver.push([drawer.x,drawer.y]);
      if(drawer.direction==0){
        ctx.moveTo(drawer.x,drawer.y+ctx.lineWidth/2);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y-ctx.lineWidth/2+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==90) {
        ctx.moveTo(drawer.x-ctx.lineWidth/2,drawer.y);
        drawer.x=drawer.x+ctx.lineWidth/2+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==180) {
        ctx.moveTo(drawer.x,drawer.y-ctx.lineWidth/2);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+ctx.lineWidth/2+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==270) {
        ctx.moveTo(drawer.x+ctx.lineWidth/2,drawer.y);
        drawer.x=drawer.x-ctx.lineWidth/2+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else{
        ctx.moveTo(drawer.x,drawer.y);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }
      ctx.lineTo(drawer.x,drawer.y);
      ctx.stroke();
    }
    map.pointLocationSaver.push([drawer.x,drawer.y]);
  }
  function BG(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.fillStyle = "#62911A";
    ctx.fillRect(0,0,1000,650);
  }
  function Start(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.fillStyle = "#FFFFFF";
    ctx.font = "100px Arial";
    ctx.textAlign = "middle";
    ctx.fillText("Defense Game", 200, 150);
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(300,275,400,100);
    ctx.font = "75px Arial";
    ctx.fillStyle = "#000000";
    ctx.textAlign = "middle";
    ctx.fillText("START", 375, 350);
    if (300<=mouse.x&&mouse.x<=700&&275<=mouse.y&&mouse.y<=375&&mouse.click) {
      Situation=1;
      requestAnimationFrame(draw);
    }
  }
  function InGame(){
    if (Timer%50==0) {
      MakeEnemy(Math.floor(Math.random()*4));
    }
    MoveEnemy();
    DrawEnemy();
    ShowBullet();
    DrawEveryTower();
    DrawTap(Select);
    ActiveTower();
    ActiveBullet();
    if (Select==-1) {
      if (mouse.click) {
        ClickTower();
      }
      TowerClick();
      if (SelectedTower!=-1) {
        var ctx = document.getElementById("MAIN").getContext("2d");
        ctx.fillStyle = 'rgba(20,20, 20, 0.5)';
        ctx.beginPath();
        ctx.strokeStyle="rgba(20,20,20,0.0)";
        ctx.arc(tower.x[SelectedTower],tower.y[SelectedTower],tower.R[SelectedTower],0,Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        DrawTower(tower.type[SelectedTower],tower.Upgrade[SelectedTower],tower.x[SelectedTower],tower.y[SelectedTower],40,tower.D[SelectedTower]);
      }
    }else{
      SelectedTower=-1;
      var ctx = document.getElementById("MAIN").getContext("2d");
      if (!IsTowerColliseWithPath()) {
        ctx.fillStyle = 'rgba(20, 0, 0, 0.5)';
      }else {
        ctx.fillStyle = 'rgba(255,20, 20, 0.5)';
      }
      ctx.beginPath();
      ctx.strokeStyle="rgba(20,20,20,0.0)";
      ctx.arc(mouse.x,mouse.y,tower_DNA.R[Select],0,Math.PI * 2);
      ctx.fill();
      ctx.stroke();
      DrawTower(Select,[0,0],mouse.x,mouse.y,40,0);
      if (mouse.click){
        if(document.getElementById("MAIN").width*3/4>=mouse.x&&!IsTowerColliseWithPath()){
          tower.type.push(Select);
          tower.Upgrade.push([0,0]);
          tower.x.push(mouse.x);
          tower.y.push(mouse.y);
          tower.D.push(0);
          tower.R.push(tower_DNA.R[Select]);
          tower.AttackDelay.push(0);
          Select=-1;
        }
      }
    }
  }
  function ActiveTower() {
    for (var i = 0; i < tower.type.length; i++) {
      target=-1;
      for (var j = enemy.x.length; j >=0; --j) {
        if (IsRangeInRange(i,j)) {
          target=j;
        }
      }
      if (target!=-1) {
        tower.D[i]=AngleOfTwoPoint([tower.x[i],tower.y[i]],[enemy.x[target],enemy.y[target]]);
        Shot(i);
      }
    }
  }
  function Shot(TowerNum){
    target=-1;
    for (var j = enemy.x.length; j >=0; --j) {
      if (IsRangeInRange(TowerNum,j)) {
        target=j;
      }
    }
    if (target!=-1&&tower.AttackDelay[TowerNum]==0) {
      bullet.hp.push(bullet_DNA.hp[tower.type[TowerNum]]);
      bullet.x.push(tower.x[TowerNum]);
      bullet.y.push(tower.y[TowerNum]);
      bullet.D.push(tower.D[TowerNum]);
      bullet.type.push(tower.type[TowerNum]);
      bullet.TargetLocation.push([enemy.x[target],enemy.y[target]]);
      bullet.target.push(target);
      tower.AttackDelay[TowerNum]=tower_DNA.Delay[tower.type[TowerNum]];
    }
  }
  function ActiveBullet() {
    for (var i = 0; i < bullet.x.length; i++) {
      touch=-1;
      for (var j = 0; j < enemy.x.length; j++) {
        switch (enemy_DNA.shape[enemy.type[j]]) {
          case 0:
          if(Ccollision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],bullet_DNA.size[bullet.type[i]],enemy_DNA.size[enemy.type[j]])){
            touch=j;
          }
          break;
          case 1:
          if(collision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],bullet_DNA.size[bullet.type[i]],enemy_DNA.size[enemy.type[j]])){
            touch=j;
          }
          break;
        }
      }
      if (touch!=-1) {
        enemy.hp[touch]-=1;
        bullet.hp[i]-=1;
        if (enemy.hp[touch]!=0) {
          enemy.type[touch]-=1;
        }
      }
      if (bullet.hp[i]<=0||bullet.x[i]<=0||bullet.y[i]<=0||bullet.x[i]>=document.getElementById("MAIN").width||bullet.y[i]>=document.getElementById("MAIN").height) {
        bullet.hp.splice(i,1);
        bullet.x.splice(i,1);
        bullet.y.splice(i,1);
        bullet.D.splice(i,1);
        bullet.type.splice(i,1);
        bullet.TargetLocation.splice(i,1);
        bullet.target.splice(i,1);
      }else{
        bullet.x[i]+=Math.cos(Math.PI/180*(bullet.D[i]-90))*bullet_DNA.speed[bullet.type[i]];
        bullet.y[i]+=Math.sin(Math.PI/180*(bullet.D[i]-90))*bullet_DNA.speed[bullet.type[i]];
      }
    }
  }
  function ShowBullet() {
    var ctx = document.getElementById("MAIN").getContext("2d");
    for (var i = 0; i < bullet.x.length; i++) {
      ctx.beginPath();
      ctx.strokeStyle="#202020";
      ctx.fillStyle = "#6060FF";
      ctx.arc(bullet.x[i],bullet.y[i],bullet_DNA.size[bullet.type[i]],0,Math.PI * 2);
      ctx.fill();
      ctx.stroke();
    }
  }
  function ClickTower() {
    click=-1;
    for (var i = 0; i < tower.x.length; i++) {
      if (tower.x[i]-20<=mouse.x&&mouse.x<=tower.x[i]+20&&mouse.y<=tower.y[i]+20&&mouse.y>=tower.y[i]-20) {
        click=i;
      }
    }
    SelectedTower=click;
  }
  function IsRangeInRange(TowerNum,EnemyNum) {
    switch (enemy_DNA.shape[enemy.type[EnemyNum]]) {
      case 0:
      if(Ccollision(tower.x[TowerNum],tower.y[TowerNum],enemy.x[EnemyNum],enemy.y[EnemyNum],tower.R[TowerNum],enemy_DNA.size[enemy.type[EnemyNum]])){
        return 1;
      }
      break;
      case 1:
      if(collision(tower.x[TowerNum],tower.y[TowerNum],enemy.x[EnemyNum],enemy.y[EnemyNum],tower.R[TowerNum],enemy_DNA.size[enemy.type[EnemyNum]])){
        return 1;
      }
      break;
    }
    return 0;
  }
  function AngleOfTwoPoint([ax,ay],[bx,by]) {
    return Math.atan2(by-ay,bx-ax)*180/Math.PI+90;
  }
  function DrawEveryTower() {
    for (var i = 0; i < tower.type.length; i++) {
      DrawTower(tower.type[i],tower.Upgrade[i],tower.x[i],tower.y[i],40,tower.D[i]);
    }
  }
  function IsTowerColliseWithPath() {
    for (var i = 0; i < map.pointLocationSaver.length-1; i++) {
      if (Rcollision([mouse.x-20,mouse.y-20,mouse.x+20,mouse.y+20],[map.pointLocationSaver[i][0]-20,map.pointLocationSaver[i][1]-20,map.pointLocationSaver[i+1][0]+20,map.pointLocationSaver[i+1][1]+20*(map.Devent[i]==90||map.Devent[i]==270)-20*(map.Devent[i]==180||map.Devent[i]==0)])) {
        return 1;
      }
    }
    for (var i = 0; i < tower.x.length; i++) {
      if (Rcollision([mouse.x-20,mouse.y-20,mouse.x+20,mouse.y+20],[tower.x[i]-20,tower.y[i]-20,tower.x[i]+20,tower.y[i]+20])) {
        return 1;
      }
    }
    return 0;
  }
  function DrawEnemy(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    for (var i = 0; i < enemy.x.length; i++) {
      ctx.beginPath();
      switch (enemy.type[i]) {
        case 0:
        ctx.fillStyle = "#FF0000";
        ctx.arc(enemy.x[i],enemy.y[i],15,0,2*Math.PI);
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#000000';
        break;
        case 1:
        ctx.fillStyle = "#FF7F00";
        ctx.arc(enemy.x[i],enemy.y[i],15,0,2*Math.PI);
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#000000';
        break;
        case 2:
        ctx.fillStyle = "#FFFF00";
        ctx.arc(enemy.x[i],enemy.y[i],15,0,2*Math.PI);
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#000000';
        break;
        case 3:
        ctx.fillStyle = "#8B00FF";
        ctx.arc(enemy.x[i],enemy.y[i],15,0,2*Math.PI);
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#000000';
        break;
      }
      ctx.stroke();
    }
  }
  function MoveEnemy(){
    for (var i = 0; i < enemy.D.length; i++) {
      if (enemy.hp[i]<=0) {
        enemy.hp.splice(i,1);
        enemy.D.splice(i,1);
        enemy.point.splice(i,1);
        enemy.point_Saver.splice(i,1);
        enemy.type.splice(i,1);
        enemy.x.splice(i,1);
        enemy.y.splice(i,1);
      }else{
        enemy.x[i]+=Math.cos(Math.PI/180*(enemy.D[i]-90))*enemy_DNA.speed[enemy.type[i]];
        enemy.y[i]+=Math.sin(Math.PI/180*(enemy.D[i]-90))*enemy_DNA.speed[enemy.type[i]]; //여기부터
        enemy.point[i]+=enemy_DNA.speed[enemy.type[i]];
        if (map.point[enemy.point_Saver[i]]+20<=enemy.point[i]){
          if (map.point[enemy.point_Saver[i]]+20!=enemy.point[i]) {
            ;
          }
          enemy.point_Saver[i]+=1;
          enemy.D[i]=map.Devent[enemy.point_Saver[i]];
          enemy.point[i]=0;
          if (enemy.point_Saver[i]==map.point.length) {
            enemy.hp.splice(i,1);
            enemy.D.splice(i,1);
            enemy.point.splice(i,1);
            enemy.point_Saver.splice(i,1);
            enemy.type.splice(i,1);
            enemy.x.splice(i,1);
            enemy.y.splice(i,1);
          }
        }
      }
    }
  }
  function MakeEnemy(type){
    enemy.hp.push(enemy_DNA.hp[type]);
    enemy.D.push(90);
    enemy.point.push(0);
    enemy.point_Saver.push(0);
    enemy.type.push(type);
    enemy.x.push(0);
    enemy.y.push(map.start);
  }
  function DrawTap(mod){
    var canvas = document.getElementById("MAIN");
    var ctx = document.getElementById("MAIN").getContext("2d");
    if (mod==-1) {
      ctx.beginPath();
      ctx.fillStyle="#964B00";
      ctx.fillRect(canvas.width*3/4,0,canvas.width,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.lineWidth=5;
      ctx.strokeStyle="#000000";
      ctx.moveTo(canvas.width*3/4,0);
      ctx.lineTo(canvas.width*3/4,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.width*1/16);
      ctx.lineTo(canvas.width,canvas.width*1/16);
      ctx.stroke();
      ctx.fillStyle="#FFFFFF";
      for (var i = 0; i < 6; i++) {
        ctx.beginPath();
        ctx.fillRect(canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64,canvas.width*(Math.floor(i/2)+1)/8+5,canvas.width*1/8-canvas.width*2/64,canvas.width*1/8-canvas.width*2/64);
        ctx.stroke();
        ctx.beginPath();
        ctx.rect(canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64,canvas.width*(Math.floor(i/2)+1)/8+5,canvas.width*1/8-canvas.width*2/64,canvas.width*1/8-canvas.width*2/64);
        ctx.stroke();
      }
      DrawTower(0,[0,0],canvas.width*3/4+canvas.width*1/16,canvas.width*3/16,50,0);
      DrawTower(1,[0,0],canvas.width*3/4+canvas.width*1/8+canvas.width*3/64,canvas.width*3/16,50,0);
    }else{
      ctx.beginPath();
      ctx.fillStyle="#964B00";
      ctx.fillRect(canvas.width*3/4,0,canvas.width,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.lineWidth=5;
      ctx.strokeStyle="#000000";
      ctx.moveTo(canvas.width*3/4,0);
      ctx.lineTo(canvas.width*3/4,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.width*1/16);
      ctx.lineTo(canvas.width,canvas.width*1/16);
      ctx.stroke();
      ctx.fillStyle="#FFFFFF";
    }
  }
  function collision(ox,oy,rx,ry,rs,or){
    if ((rx-rs-or<=ox&& ox<=rx+rs+or)&&(ry-rs-or<=oy&&oy<=ry+rs+or)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx-rs,ry+rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx+rs,ry+rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx-rs,ry-rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx+rs,ry-rs)) {
      return 1;
    }
    return 0;
  }
  function Ccollision(ax,ay,bx,by,ar,br) {
    if (Math.sqrt((ax-bx)**2+(ay-by)**2)<=ar+br) {
      return 1;
    }
    return 0;
  }
  function TowerClick(){
    var canvas = document.getElementById("MAIN");
    Select=-1;
    for (var i = 0; i < 2; i++) {
      if (canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64+10<=mouse.x&& mouse.x<=canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64+5+canvas.width*1/8-canvas.width*2/64 && canvas.width*(Math.floor(i/2)+1)/8+15<=mouse.y&&mouse.y<=canvas.width*(Math.floor(i/2)+1)/8+10+canvas.width*1/8-canvas.width*2/64 && mouse.click) {
        Select=i;
        return ;
      }
    }
  }
  function Rcollision(Rect1,Rect2){ //[x1,y1,x2,y2]
    AR={
      L : Rect1[0]*(Rect1[0]<=Rect1[2])+Rect1[2]*(Rect1[0]>Rect1[2]),
      R : Rect1[2]*(Rect1[0]<=Rect1[2])+Rect1[0]*(Rect1[0]>Rect1[2]),
      U : Rect1[1]*(Rect1[1]<=Rect1[3])+Rect1[3]*(Rect1[1]>Rect1[3]),
      D : Rect1[3]*(Rect1[1]<=Rect1[3])+Rect1[1]*(Rect1[1]>Rect1[3])
    }
    BR={
      L : Rect2[0]*(Rect2[0]<=Rect2[2])+Rect2[2]*(Rect2[0]>Rect2[2]),
      R : Rect2[2]*(Rect2[0]<=Rect2[2])+Rect2[0]*(Rect2[0]>Rect2[2]),
      U : Rect2[1]*(Rect2[1]<=Rect2[3])+Rect2[3]*(Rect2[1]>Rect2[3]),
      D : Rect2[3]*(Rect2[1]<=Rect2[3])+Rect2[1]*(Rect2[1]>Rect2[3])
    }
    if (AR.L<=BR.R&&AR.U<=BR.D&&AR.R>=BR.L&&AR.D>=BR.U) {
      return 1;
    }
    return 0;
  }
  function IsPointInCircle(ox,oy,or,px,py){
    return Math.sqrt((ox-px)**2+(oy-py))<=or;
  }
  </script>
</head>
<body onload="draw()">
  <canvas id="MAIN" width="1000" height="650"></canvas>
</body
</html>
