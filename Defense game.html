<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Defense Game</title>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <script type="text/javascript">
  var effect={
    x:[],
    y:[],
    Fx:[],
    Fy:[],
    type:[],
    value:[],
    Delay:[]
  };
  var bullet_DNA={
    hp:[1,1,0,7,3],
    speed:[4,5,0,3,7],
    size:[10,8,0,18,7]
  }
  var bullet={
    hp:[],
    x:[],
    y:[],
    D:[],
    type:[],
    TargetLocation:[],
    target:[]
  }
  var enemy_DNA={
    hp:[1,2,3,4,5,6],
    speed:[1,1.1,1.2,2,2.1,2.2],
    shape:[0,0,0,0,0,0], //0:원,1:사각형
    size:[15,15,15,15,20,20],
    cost:[1,2,3,4,6,7,8]
  };
  var tower_DNA={
    R:[150,100,50,100,210],
    cost:[120,300,1000,250,500],
    Delay:[80,40,10000,250,80],
    name:["Basic Tower","Gatling Tower","Money Tower","Mega Tower","Point Tower"]
  };
  var enemy={
    hp:[],
    type:[],
    D:[],
    point:[],
    point_Saver:[],
    x:[],
    y:[],
    cost:[]
  };
  var tower={
    type:[],
    Upgrade:[],
    D:[],
    R:[],
    AttackDelay:[],
    x:[],
    y:[]
  };
  var map={
    start:500,
    point:[115,400,115,400,115,400,115,400,115,500],
    Devent:[90,0,90,180,90,0,90,180,90,0],
    pointLocationSaver:[]
  };
  var mouse={
    x:0,
    y:0,
    click:0
  };
  var TowerTapEvent=0;
  var fastmod=0;
  var Round_DNA=[[50,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[50,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1],[30,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[30,4,4,4,4,4,4,4,4],[30,0,5,5,5]];
  var Round=0;
  var Round_summon=1;
  var OnRound=0;
  var EnemySummon=0;
  var money=500;
  var Situation=0;
  var Timer=0;
  var HP=100;
  var Select=-1;
  var ESC=0;
  var SPACE=0;
  var POP=0;
  var ONE=0;
  var heartIMG = new Image();
  SelectedTower=-1;
  window.addEventListener('mousemove',function(e){
    mouse.x=e.x;
    mouse.y=e.y;
  });
  $(document).click(function (evt) {
    mouse.click=1;
  })
  $(document).keydown(function(e) {
    if (e.keyCode==27) {
      ESC=1;
    }else if (e.keyCode==32) {
      SPACE=1;
    }
  }).keyup(function(e) {
    if (e.keyCode==27) {
      ESC=0;
    }else if (e.keyCode==32) {
      SPACE=0;
    }
  });
  function draw(){
    var canvas = document.getElementById("MAIN");
    if(canvas.getContext){
      var ctx = canvas.getContext("2d");
      BG();
      switch (Situation) {
        case 0:
          Start();
          ctx.drawImage(heartIMG,canvas.width/2,canvas.height/2,300,300);
          heartIMG.scr='https://mini2317.github.io/hearth.png';
          break;
        case 1:
          Timer+=1;
          EnemySummon+=1+fastmod;
          DrawPath();
          InGame();
          for (var i = 0; i < tower.AttackDelay.length; i++) {
            if (tower.AttackDelay[i]!=0) {
              tower.AttackDelay[i]-=1+fastmod;
            }
          }
          break;
      }
      requestAnimationFrame(draw);
    }
    mouse.click=0;
  }
  function DrawTower(type,upgrade,x,y,size,direction){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.beginPath();
    ctx.fillStyle="#606060";
    ctx.fillRect(x-size/2,y-size/2,size,size);
    ctx.stroke();
    ctx.beginPath();
    ctx.lineWidth=3*(size/50);
    ctx.strokeStyle="#202020";
    ctx.rect(x-size/2,y-size/2,size,size);
    ctx.stroke();
    switch(type){
      case 0:
        if (upgrade[0]>=2) {
          DrawGear(direction,x-size/2,y,size/1.5,);
          DrawGear(direction,x+size/2,y,size/1.5,);
          ctx.beginPath();
          ctx.fillStyle="#606060";
          ctx.fillRect(x-size/2,y-size/2,size,size);
          ctx.stroke();
          ctx.beginPath();
          ctx.lineWidth=3*(size/50);
          ctx.strokeStyle="#202020";
          ctx.rect(x-size/2,y-size/2,size,size);
          ctx.stroke();
        }
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-(size/10);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10),y+Math.sin(Math.PI/180*(direction-90))*(size-size/10));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-(size/5);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)),y+Math.sin(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)));
        ctx.stroke();
        ctx.lineWidth=3*(size/50);
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.arc(x,y,size/2-(5*size/50),0,Math.PI * 2);
        ctx.fillStyle = "#6060FF";
        ctx.fill();
        ctx.stroke();
        if (upgrade[0]>=1) {
          DrawGear(Timer,x,y,size/1.5,);
        }
        break;
      case 1:
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        Size=size/10;
        ctx.lineWidth=size/2-Size/2;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size-Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/15)-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/15)-Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-(Size/2);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size+Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/15)+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/15)+Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-Size;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size-Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10)-Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/10)-Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-(Size);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*Size+Math.sin(Math.PI/180*direction)*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10)+Math.cos(Math.PI/180*direction)*Size,y+Math.sin(Math.PI/180*(direction-90))*(size-size/10)+Math.sin(Math.PI/180*direction)*Size);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-size/15;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*Size,y+Math.sin(Math.PI/180*(direction-90))*Size);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*size*1,y+Math.sin(Math.PI/180*(direction-90))*size*1);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-8*size/50;
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-90))*size/5,y+Math.sin(Math.PI/180*(direction-90))*size/5);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size*1-(-size/15+8*size/50)/2),y+Math.sin(Math.PI/180*(direction-90))*(size*1-(-size/15+8*size/50)/2));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.fillStyle = "#6060FF";
        ctx.lineWidth=3*(size/50);
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction-45))*size/2,y+Math.sin(Math.PI/180*(direction-45))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+45))*size/2,y+Math.sin(Math.PI/180*(direction+45))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+135))*size/2,y+Math.sin(Math.PI/180*(direction+135))*size/2);
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x+Math.cos(Math.PI/180*(direction+135))*size/2,y+Math.sin(Math.PI/180*(direction+135))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+225))*size/2,y+Math.sin(Math.PI/180*(direction+225))*size/2);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction+315))*size/2,y+Math.sin(Math.PI/180*(direction+315))*size/2);
        ctx.fill();
        ctx.stroke();
        break;
      case 2:
        ctx.lineWidth=3*(size/50);
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        if (upgrade[0]==0) {
          ctx.fillStyle = "#FFFF00";
        }else {
          ctx.fillStyle = "#D80000";
        }
        if (upgrade[0]==2) {
          ctx.fillRect(x-size/2,y-size/4,size,size/2);
        }else {
          ctx.arc(x,y,size/2-(5*size/50),0,Math.PI * 2);
          ctx.fill();
        }
        ctx.stroke();
        if (upgrade[0]==2) {
          ctx.font = 20*size/40+"px Arial";
        }else{
          ctx.font = 30*size/40+"px Arial";
        }
        ctx.fillStyle = "#000000";
        ctx.textAlign = "left";
        ctx.fillText("$",x-size*3/16,y+size/4);
        break;
      case 3:
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/1.25-(size/10);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10),y+Math.sin(Math.PI/180*(direction-90))*(size-size/10));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/1.25-(size/5);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)),y+Math.sin(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)));
        ctx.stroke();
        ctx.lineWidth=3*(size/50);
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.arc(x,y,size/2-(5*size/50),0,Math.PI * 2);
        ctx.fillStyle="#6060FF";
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.arc(x,y,size/2-(10*size/50),0,Math.PI * 2);
        ctx.fillStyle="#6060FF";
        ctx.fill();
        ctx.stroke();
        break;
      case 4:
        ctx.beginPath();
        ctx.strokeStyle="#202020";
        ctx.lineWidth=size/2-(size/10);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*(size-size/10),y+Math.sin(Math.PI/180*(direction-90))*(size-size/10));
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle="#868e96";
        ctx.lineWidth=size/2-(size/5);
        ctx.moveTo(x,y);
        ctx.lineTo(x+Math.cos(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)),y+Math.sin(Math.PI/180*(direction-90))*((size-size/10)-3*(size/50)));
        ctx.stroke();
        ctx.beginPath();
        ctx.lineWidth=size/20;
        ctx.strokeStyle="#202020";
        ctx.moveTo(move(direction+120,x,y,size*4/8)[0],move(direction+120,x,y,size*4/8)[1]);
        ctx.lineTo(move(direction,x,y,size*4/8)[0],move(direction,x,y,size*4/8)[1]);
        ctx.lineTo(move(direction-120,x,y,size*4/8)[0],move(direction-120,x,y,size*4/8)[1]);
        ctx.fillStyle="#6060FF";
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(move(direction+120,x,y,size*4/8)[0],move(direction+120,x,y,size*4/8)[1]);
        ctx.lineTo(move(direction-120,x,y,size*4/8)[0],move(direction-120,x,y,size*4/8)[1]);
        ctx.stroke();
        break;
    }
  }
  function move(D,StartX,StartY,value){
    return [StartX+Math.cos(Math.PI/180*(D-90))*value,StartY+Math.sin(Math.PI/180*(D-90))*value]
  }
  function DrawPath() {
    var ctx = document.getElementById("MAIN").getContext("2d");
    drawer={
      direction:90,
      x:0,
      y:map.start
    };
    ctx.lineWidth=40;
    ctx.strokeStyle="#868e96";
    ctx.beginPath();
    ctx.strokeStyle="#868e96";
    ctx.moveTo(0,drawer.y);
    ctx.stroke();
    map.pointLocationSaver=[];
    for (var i = 0; i < map.point.length; i++) {
      ctx.beginPath();
      drawer.direction=map.Devent[i];
      map.pointLocationSaver.push([drawer.x,drawer.y]);
      if(drawer.direction==0){
        ctx.moveTo(drawer.x,drawer.y+ctx.lineWidth/2);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y-ctx.lineWidth/2+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==90) {
        ctx.moveTo(drawer.x-ctx.lineWidth/2,drawer.y);
        drawer.x=drawer.x+ctx.lineWidth/2+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==180) {
        ctx.moveTo(drawer.x,drawer.y-ctx.lineWidth/2);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+ctx.lineWidth/2+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else if (drawer.direction==270) {
        ctx.moveTo(drawer.x+ctx.lineWidth/2,drawer.y);
        drawer.x=drawer.x-ctx.lineWidth/2+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }else{
        ctx.moveTo(drawer.x,drawer.y);
        drawer.x=drawer.x+Math.cos(Math.PI/180*(map.Devent[i]-90))*map.point[i];
        drawer.y=drawer.y+Math.sin(Math.PI/180*(map.Devent[i]-90))*map.point[i];
      }
      ctx.lineTo(drawer.x,drawer.y);
      ctx.stroke();
    }
    map.pointLocationSaver.push([drawer.x,drawer.y]);
  }
  function BG(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.fillStyle = "#62911A";
    ctx.fillRect(0,0,1000,650);
  }
  function Start(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.fillStyle = "#FFFFFF";
    ctx.font = "100px Arial";
    ctx.textAlign = "left";
    ctx.fillText("Defense Game", 200, 150);
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(300,275,400,100);
    ctx.font = "75px Arial";
    ctx.fillStyle = "#000000";
    ctx.textAlign = "left";
    ctx.fillText("START", 375, 350);
    if (300<=mouse.x&&mouse.x<=700&&275<=mouse.y&&mouse.y<=375&&mouse.click) {
      Situation=1;
      requestAnimationFrame(draw);
    }
  }
  function InGame(){
    if(OnRound==1&&Round<Round_DNA.length){
      if (Round_DNA[Round][0]==0) {
        while (Round_DNA[Round].length>Round_summon) {
          MakeEnemy(Round_DNA[Round][Round_summon]);
          Round_summon+=1;
        }
      }
      if (EnemySummon==Round_DNA[Round][0]&&Round_DNA[Round].length>Round_summon) {
        MakeEnemy(Round_DNA[Round][Round_summon]);
        Round_summon+=1;
        EnemySummon=0;
      }
      if (enemy.x.length==0&&Round_DNA[Round].length<=Round_summon&&ONE==0) { //라운드가 끝날때 1번 실행됨.
        for (var i = 0; i < tower.x.length; i++) {
          if (tower.type[i]==2) {
            if (tower.Upgrade[i]=[0,0]) {
              MakeEffect(tower.x[i],tower.y[i],0,100);
              money+=100;
            }
          }
        }
        for (var i = 0; i < bullet.type.length; i++) {
          bullet.hp.splice(i,1);
          bullet.x.splice(i,1);
          bullet.y.splice(i,1);
          bullet.D.splice(i,1);
          bullet.type.splice(i,1);
          bullet.TargetLocation.splice(i,1);
          bullet.target.splice(i,1);
        }
        ONE=1;
      }
      if (enemy.x.length==0&&Round_DNA[Round].length<=Round_summon) {
        money+=POP;
        OnRound=0;
        POP=0;
        Round+=1;
      }
    }else {
      EnemySummon=0;
      Round_summon=1;
    }
    MoveEnemy();
    DrawEnemy();
    ShowBullet();
    DrawEveryTower();
    DrawTap(Select);
    ActiveTower();
    ActiveBullet();
    if (Select==-1) {
      if (mouse.click) {
        ClickTower();
      }
      TowerClick();
      if (SelectedTower!=-1) {
        var ctx = document.getElementById("MAIN").getContext("2d");
        ctx.fillStyle = 'rgba(20,20, 20, 0.5)';
        ctx.beginPath();
        ctx.strokeStyle="rgba(20,20,20,0.0)";
        ctx.arc(tower.x[SelectedTower],tower.y[SelectedTower],tower.R[SelectedTower],0,Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        DrawTower(tower.type[SelectedTower],tower.Upgrade[SelectedTower],tower.x[SelectedTower],tower.y[SelectedTower],40,tower.D[SelectedTower]);
        TowerTapClick(SelectedTower);
        DrawTowerTap(SelectedTower);
      }
    }else{
      SelectedTower=-1;
      var ctx = document.getElementById("MAIN").getContext("2d");
      if (!IsTowerColliseWithPath()) {
        ctx.fillStyle = 'rgba(20, 0, 0, 0.5)';
      }else {
        ctx.fillStyle = 'rgba(255,20, 20, 0.5)';
      }
      ctx.beginPath();
      ctx.strokeStyle="rgba(20,20,20,0.0)";
      ctx.arc(mouse.x,mouse.y,tower_DNA.R[Select],0,Math.PI * 2);
      ctx.fill();
      ctx.stroke();
      DrawTower(Select,[0,0],mouse.x,mouse.y,40,0);
      if (ESC==1) {
        Select=-1;
      }
      if (mouse.click){
        if(document.getElementById("MAIN").width*3/4>mouse.x&&!IsTowerColliseWithPath()){
          tower.type.push(Select);
          tower.Upgrade.push([0,0]);
          tower.x.push(mouse.x);
          tower.y.push(mouse.y);
          tower.D.push(0);
          tower.R.push(tower_DNA.R[Select]);
          tower.AttackDelay.push(0);
          money-=tower_DNA.cost[Select];
          Select=-1;
        }else if (document.getElementById("MAIN").width*3/4<=mouse.x) {
          Select=-1;
        }
      }
    }
    ActiveEffect();
  }
  function MakeTower(type,x,y,upgrade,d) {
    tower.type.push(type);
    tower.Upgrade.push(upgrade);
    tower.x.push(x);
    tower.y.push(y);
    tower.D.push(d);
    tower.R.push(tower_DNA.R[type]);
    tower.AttackDelay.push(0);
  }
  function ActiveTower() {
    for (var i = 0; i < tower.type.length; i++) {
      target=-1;
      for (var j = enemy.x.length; j >=0; --j) {
        if (IsRangeInRange(i,j)) {
          target=j;
        }
      }
      if (target!=-1) {
        tower.D[i]=AngleOfTwoPoint([tower.x[i],tower.y[i]],[enemy.x[target],enemy.y[target]]);
        Shot(i);
      }
    }
  }
  function Shot(TowerNum){
    target=-1;
    for (var j = enemy.x.length; j >=0; --j) {
      if (IsRangeInRange(TowerNum,j)) {
        target=j;
      }
    }
    if (target!=-1&&tower.AttackDelay[TowerNum]<=0) {
      bullet.hp.push(bullet_DNA.hp[tower.type[TowerNum]]);
      bullet.x.push(tower.x[TowerNum]);
      bullet.y.push(tower.y[TowerNum]);
      bullet.D.push(tower.D[TowerNum]);
      bullet.type.push(tower.type[TowerNum]);
      bullet.TargetLocation.push([enemy.x[target],enemy.y[target]]);
      bullet.target.push(target);
      tower.AttackDelay[TowerNum]=tower_DNA.Delay[tower.type[TowerNum]];
    }
  }
  function ActiveBullet() {
    for (var i = 0; i < bullet.x.length; i++) {
      touch=-1;
      for (var j = 0; j < enemy.x.length; j++) {
        switch (enemy_DNA.shape[enemy.type[j]]) {
          case 0:
          if(Ccollision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],bullet_DNA.size[bullet.type[i]],enemy_DNA.size[enemy.type[j]])){
            touch=j;
          }
          break;
          case 1:
          if(collision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],bullet_DNA.size[bullet.type[i]],enemy_DNA.size[enemy.type[j]])){
            touch=j;
          }
          break;
        }
      }
      if (touch!=-1) {
        if (enemy.hp[touch]<=bullet.hp[i]) {
          bullet.hp[i]-=enemy.hp[touch];
          enemy.hp[touch]=0;
        }else if(enemy.hp[touch]>bullet.hp[i]){
          enemy.hp[touch]-=bullet.hp[i];
          bullet.hp[i]=0;
        }else{
          enemy.hp[touch]-=1;
          bullet.hp[i]-=1;
        }
        if (enemy.hp[touch]!=0) {
          enemy.type[touch]-=1;
        }else if (bullet.type[i]==4 && enemy.type.length!=0) {
          touch=-1;
          for (var j = 0; j < enemy.x.length; j++) {
            switch (enemy_DNA.shape[enemy.type[j]]) {
              case 0:
              if(Ccollision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],50,enemy_DNA.size[enemy.type[j]])){
                touch=j;
              }
              break;
              case 1:
              if(collision(bullet.x[i],bullet.y[i],enemy.x[j],enemy.y[j],50,enemy_DNA.size[enemy.type[j]])){
                touch=j;
              }
              break;
            }
          }
          if(touch!=-1){
            bullet.target[i]=touch;
          }
        }
      }
      if(bullet.type[i]==4){
        bullet.D[i]=AngleOfTwoPoint([bullet.x[i],bullet.y[i]],[enemy.x[bullet.target[i]],enemy.y[bullet.target[i]]]);
        console.log(bullet.D[i]);
      }
      if (bullet.hp[i]<=0||bullet.x[i]<=0||bullet.y[i]<=0||bullet.x[i]>=document.getElementById("MAIN").width||bullet.y[i]>=document.getElementById("MAIN").height) {
        bullet.hp.splice(i,1);
        bullet.x.splice(i,1);
        bullet.y.splice(i,1);
        bullet.D.splice(i,1);
        bullet.type.splice(i,1);
        bullet.TargetLocation.splice(i,1);
        bullet.target.splice(i,1);
      }else{
        bullet.x[i]+=Math.cos(Math.PI/180*(bullet.D[i]-90))*(bullet_DNA.speed[bullet.type[i]]+bullet_DNA.speed[bullet.type[i]]*fastmod);
        bullet.y[i]+=Math.sin(Math.PI/180*(bullet.D[i]-90))*(bullet_DNA.speed[bullet.type[i]]+bullet_DNA.speed[bullet.type[i]]*fastmod);
      }
    }
  }
  function ShowBullet() {
    var ctx = document.getElementById("MAIN").getContext("2d");
    for (var i = 0; i < bullet.x.length; i++) {
      ctx.beginPath();
      ctx.strokeStyle="#202020";
      ctx.fillStyle = "#6060FF";
      ctx.lineWidth = 1;
      ctx.arc(bullet.x[i],bullet.y[i],bullet_DNA.size[bullet.type[i]],0,Math.PI * 2);
      ctx.fill();
      ctx.stroke();
    }
  }
  function ClickTower() {
    click=-1;
    for (var i = 0; i < tower.x.length; i++) {
      if (tower.x[i]-20<=mouse.x&&mouse.x<=tower.x[i]+20&&mouse.y<=tower.y[i]+20&&mouse.y>=tower.y[i]-20) {
        click=i;
      }
    }
    if(!(85<=mouse.x&&mouse.x<=690&&mouse.y>=455)){
      SelectedTower=click;
    }
  }
  function IsRangeInRange(TowerNum,EnemyNum) {
    switch (enemy_DNA.shape[enemy.type[EnemyNum]]) {
      case 0:
      if(Ccollision(tower.x[TowerNum],tower.y[TowerNum],enemy.x[EnemyNum],enemy.y[EnemyNum],tower.R[TowerNum],enemy_DNA.size[enemy.type[EnemyNum]])){
        return 1;
      }
      break;
      case 1:
      if(collision(tower.x[TowerNum],tower.y[TowerNum],enemy.x[EnemyNum],enemy.y[EnemyNum],tower.R[TowerNum],enemy_DNA.size[enemy.type[EnemyNum]])){
        return 1;
      }
      break;
    }
    return 0;
  }
  function AngleOfTwoPoint([ax,ay],[bx,by]) {
    return Math.atan2(by-ay,bx-ax)*180/Math.PI+90;
  }
  function DrawEveryTower() {
    for (var i = 0; i < tower.type.length; i++) {
      DrawTower(tower.type[i],tower.Upgrade[i],tower.x[i],tower.y[i],40,tower.D[i]);
    }
  }
  function IsTowerColliseWithPath() {
    for (var i = 0; i < map.pointLocationSaver.length-1; i++) {
      if (Rcollision([mouse.x-20,mouse.y-20,mouse.x+20,mouse.y+20],[map.pointLocationSaver[i][0]-20,map.pointLocationSaver[i][1]-20,map.pointLocationSaver[i+1][0]+20,map.pointLocationSaver[i+1][1]+20*(map.Devent[i]==90||map.Devent[i]==270)-20*(map.Devent[i]==180||map.Devent[i]==0)])) {
        return 1;
      }
    }
    for (var i = 0; i < tower.x.length; i++) {
      if (Rcollision([mouse.x-20,mouse.y-20,mouse.x+20,mouse.y+20],[tower.x[i]-20,tower.y[i]-20,tower.x[i]+20,tower.y[i]+20])) {
        return 1;
      }
    }
    return 0;
  }
  function DrawEnemy(){
    var ctx = document.getElementById("MAIN").getContext("2d");
    for (var i = 0; i < enemy.x.length; i++) {
      ctx.beginPath();
      switch (enemy.type[i]) {
        case 0:
        ctx.fillStyle = "#FF0000";
        break;
        case 1:
        ctx.fillStyle = "#FF7F00";
        break;
        case 2:
        ctx.fillStyle = "#FFFF00";
        break;
        case 3:
        ctx.fillStyle = "#8B00FF";
        break;
        case 4:
        ctx.fillStyle = "#8B8DFF";
        break;
        case 5:
        ctx.fillStyle = "#FBF8FD";
        break;
      }
      if (enemy_DNA.shape[enemy.type[i]]==0) {
        ctx.arc(enemy.x[i],enemy.y[i],enemy_DNA.size[enemy.type[i]],0,2*Math.PI);
        ctx.fill();
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#000000';
      }
      ctx.stroke();
    }
  }
  function MoveEnemy(){
    for (var i = 0; i < enemy.D.length; i++) {
      if (enemy.hp[i]<=0) {
        money+=enemy.cost[i];
        POP+=enemy.cost[i];
        enemy.hp.splice(i,1);
        enemy.D.splice(i,1);
        enemy.point.splice(i,1);
        enemy.point_Saver.splice(i,1);
        enemy.type.splice(i,1);
        enemy.x.splice(i,1);
        enemy.y.splice(i,1);
        enemy.cost.splice(i,1);
      }else{
        enemy.x[i]+=Math.cos(Math.PI/180*(enemy.D[i]-90))*(enemy_DNA.speed[enemy.type[i]]+enemy_DNA.speed[enemy.type[i]]*fastmod);
        enemy.y[i]+=Math.sin(Math.PI/180*(enemy.D[i]-90))*(enemy_DNA.speed[enemy.type[i]]+enemy_DNA.speed[enemy.type[i]]*fastmod); //여기부터
        enemy.point[i]+=enemy_DNA.speed[enemy.type[i]]+enemy_DNA.speed[enemy.type[i]]*fastmod;
        if (map.point[enemy.point_Saver[i]]+20<=enemy.point[i]){
          if (map.point[enemy.point_Saver[i]]+20!=enemy.point[i]) {
            enemy.x[i]=map.pointLocationSaver[enemy.point_Saver[i]+1][0];
            enemy.y[i]=map.pointLocationSaver[enemy.point_Saver[i]+1][1];
          }
          enemy.point_Saver[i]+=1;
          enemy.D[i]=map.Devent[enemy.point_Saver[i]];
          enemy.point[i]=0;
          if (enemy.point_Saver[i]==map.point.length) {
            HP-=enemy.hp[i];
            enemy.hp.splice(i,1);
            enemy.D.splice(i,1);
            enemy.point.splice(i,1);
            enemy.point_Saver.splice(i,1);
            enemy.type.splice(i,1);
            enemy.x.splice(i,1);
            enemy.y.splice(i,1);
            enemy.cost.splice(i,1);
          }
        }
      }
    }
  }
  function MakeEnemy(type){
    enemy.hp.push(enemy_DNA.hp[type]);
    enemy.cost.push(enemy_DNA.cost[type]);
    enemy.D.push(90);
    enemy.point.push(0);
    enemy.point_Saver.push(0);
    enemy.type.push(type);
    enemy.x.push(0);
    enemy.y.push(map.start);
  }
  function DrawTap(mod){
    var canvas = document.getElementById("MAIN");
    var ctx = document.getElementById("MAIN").getContext("2d");
    if (mod==-1) {
      ctx.beginPath();
      ctx.fillStyle="#964B00";
      ctx.fillRect(canvas.width*3/4,0,canvas.width,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.lineWidth=5;
      ctx.strokeStyle="#000000";
      ctx.moveTo(canvas.width*3/4,0);
      ctx.lineTo(canvas.width*3/4,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.height*1/16);
      ctx.lineTo(canvas.width,canvas.height*1/16);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.height*2/16+5);
      ctx.lineTo(canvas.width,canvas.height*2/16+5);
      ctx.stroke();
      ctx.beginPath();
      ctx.fillStyle="#FFFFFF";
      ctx.fillRect(canvas.width*3/4+2.5,canvas.height*14/16+5,canvas.width*1/4-2.5,canvas.height*2/16-5);
      ctx.stroke();
      if (OnRound==0){
        if (Round<Round_DNA.length) {
          ctx.beginPath();
          ctx.fillStyle="#00FF00";
          ctx.strokeStyle="#00FF00";
          ctx.lineWidth=1;
          ctx.moveTo(canvas.width*3/4+7.5,canvas.height*14/16+15);
          ctx.lineTo(canvas.width*3/4+7.5,canvas.height*14/16+70);
          ctx.lineTo(canvas.width*3/4+50,canvas.height*14/16+(15+70)/2);
          ctx.fill();
          ctx.stroke();
          ctx.strokeStyle="#000000";
          ctx.beginPath();
          ctx.font = "50px Arial";
          ctx.fillStyle = "#000000";
          ctx.textAlign = "left";
          ctx.fillText("START",canvas.width*3/4+50,canvas.height*14/16+55);
          ctx.stroke();
        }else{
          ctx.font = "50px Arial";
          ctx.fillStyle = "#000000";
          ctx.textAlign = "left";
          ctx.fillText("THE END",canvas.width*3/4+25,canvas.height*14/16+55);
          ctx.stroke();
        }
      }else if(fastmod==0){
        ctx.beginPath();
        ctx.font = "50px Arial";
        ctx.fillStyle = "#2DA0FF";
        ctx.textAlign = "left";
        ctx.fillText("X1",canvas.width*3/4+50,canvas.height*14/16+55);
        ctx.stroke();
      }else if(fastmod==1){
        ctx.beginPath();
        ctx.font = "50px Arial";
        ctx.fillStyle = "#2DA0FF";
        ctx.textAlign = "left";
        ctx.fillText("X2",canvas.width*3/4+50,canvas.height*14/16+55);
        ctx.stroke();
      }
      ctx.lineWidth=5;
      ctx.beginPath();
      ctx.font = "30px Arial";
      ctx.fillStyle = "#60AF60";
      ctx.textAlign = "left";
      ctx.fillText("$"+money,canvas.width*3/4+2.5,30);
      ctx.stroke();
      ctx.beginPath();
      ctx.font = "30px Arial";
      ctx.fillStyle = "#FF0000";
      ctx.textAlign = "left";
      ctx.fillText("HP : "+HP,canvas.width*3/4+2.5,canvas.height*2/16-5);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.height*14/16+5);
      ctx.lineTo(canvas.width,canvas.height*14/16+5);
      ctx.stroke();
      ctx.fillStyle="#FFFFFF";
      for (var i = 0; i < 6; i++) {
        ctx.beginPath();
        ctx.fillRect(canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64,canvas.width*(Math.floor(i/2)+1)/8+5,canvas.width*1/8-canvas.width*2/64,canvas.width*1/8-canvas.width*2/64);
        ctx.stroke();
        ctx.beginPath();
        ctx.rect(canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64,canvas.width*(Math.floor(i/2)+1)/8+5,canvas.width*1/8-canvas.width*2/64,canvas.width*1/8-canvas.width*2/64);
        ctx.stroke();
      }
      DrawTower(0,[0,0],canvas.width*3/4+canvas.width*1/16,canvas.width*3/16,50,0);
      DrawTower(1,[0,0],canvas.width*3/4+canvas.width*1/8+canvas.width*3/64,canvas.width*3/16,50,0);
      DrawTower(2,[0,0],canvas.width*3/4+canvas.width*1/16,canvas.width*9.75/32,50,0);
      DrawTower(3,[0,0],canvas.width*3/4+canvas.width*1/8+canvas.width*3/64,canvas.width*9.75/32,50,0);
      DrawTower(4,[0,0],canvas.width*3/4+canvas.width*1/16,canvas.width*9.5/22,50,0);
      ctx.fillStyle="rgba(0,0,0,0.5)";
      for (var i = 0; i < 6; i++) {
        if (tower_DNA.cost[i]>money) {
          ctx.beginPath();
          ctx.fillRect(canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64,canvas.width*(Math.floor(i/2)+1)/8+5,canvas.width*1/8-canvas.width*2/64,canvas.width*1/8-canvas.width*2/64);
          ctx.stroke();
        }
      }
    }else{
      ctx.beginPath();
      ctx.fillStyle="#964B00";
      ctx.fillRect(canvas.width*3/4,0,canvas.width,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.lineWidth=5;
      ctx.strokeStyle="#000000";
      ctx.moveTo(canvas.width*3/4,0);
      ctx.lineTo(canvas.width*3/4,canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.height*1/16);
      ctx.lineTo(canvas.width,canvas.height*1/16);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(canvas.width*3/4,canvas.height*2/16+5);
      ctx.lineTo(canvas.width,canvas.height*2/16+5);
      ctx.stroke();
      ctx.fillStyle="#FFFFFF";
      ctx.beginPath();
      ctx.fillRect(canvas.width*3/4+2.5,canvas.height*2/16+7.5,canvas.width*1/4-2.5,canvas.height*14/16-7.5);
      ctx.stroke();
      ctx.beginPath();
      ctx.font = "50px Arial";
      ctx.fillStyle = "#FF0000";
      ctx.textAlign = "left";
      ctx.fillText("Cancel",canvas.width*6/8,canvas.height*9/16+7.5);
      ctx.stroke();
      ctx.font = "50px Arial";
      ctx.fillStyle = "#FF0000";
      ctx.textAlign = "left";
      ctx.fillText("[ESC]",canvas.width*6/8+10,canvas.height*10/16+7.5);
      ctx.stroke();
      ctx.beginPath();
      ctx.font = "30px Arial";
      ctx.fillStyle = "#60AF60";
      ctx.textAlign = "left";
      ctx.fillText("$"+money,canvas.width*3/4+2.5,30);
      ctx.stroke();
      ctx.beginPath();
      ctx.font = "30px Arial";
      ctx.fillStyle = "#FF0000";
      ctx.textAlign = "left";
      ctx.fillText("HP : "+HP,canvas.width*3/4+2.5,canvas.height*2/16-5);
      ctx.stroke();
    }
  }
  function collision(ox,oy,rx,ry,rs,or){
    if ((rx-rs-or<=ox&& ox<=rx+rs+or)&&(ry-rs-or<=oy&&oy<=ry+rs+or)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx-rs,ry+rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx+rs,ry+rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx-rs,ry-rs)) {
      return 1;
    }else if (IsPointInCircle(ox,oy,or,rx+rs,ry-rs)) {
      return 1;
    }
    return 0;
  }
  function Ccollision(ax,ay,bx,by,ar,br) {
    if (Math.sqrt((ax-bx)**2+(ay-by)**2)<=ar+br) {
      return 1;
    }
    return 0;
  }
  function TowerClick(){
    var canvas = document.getElementById("MAIN");
    var ctx = canvas.getContext("2d");
    Select=-1;
    for (var i = 0; i < 5; i++) {
      if (canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64+10<=mouse.x&& mouse.x<=canvas.width*3/4+canvas.width*(i%2)/8+canvas.width*((i+1)%2)/64+5+canvas.width*1/8-canvas.width*2/64 && canvas.width*(Math.floor(i/2)+1)/8+15<=mouse.y&&mouse.y<=canvas.width*(Math.floor(i/2)+1)/8+10+canvas.width*1/8-canvas.width*2/64) {
        ctx.beginPath();
        ctx.strokeStyle='rgba(0,0,0,0)';
        ctx.fillStyle='rgba(20,20,20,0,5)';
        ctx.fillRect(canvas.width*3/4-200,mouse.y-50,200,100);
        ctx.stroke();
        ctx.beginPath();
        ctx.font = "30px Arial";
        ctx.fillStyle = "#FFFFFF";
        ctx.textAlign = "left";
        ctx.fillText(tower_DNA.name[i],canvas.width*3/4-200,mouse.y-20);
        ctx.stroke();
        ctx.beginPath();
        ctx.font = "30px Arial";
        ctx.fillStyle = "#FFFFFF";
        ctx.textAlign = "left";
        ctx.fillText("$"+tower_DNA.cost[i],canvas.width*3/4-200,mouse.y+10);
        ctx.stroke();
        if(mouse.click&&tower_DNA.cost[i]<=money){
          Select=i;
          return;
        }
      }
    }
    if ((canvas.width*3/4+2.5<=mouse.x&& mouse.x<=canvas.width&&canvas.height*14/16+5<=mouse.y&&mouse.y<=canvas.height&&mouse.click&&Round<Round_DNA.length)||(SPACE&&Round<Round_DNA.length)) {
      if(OnRound==0){
        fastmod=0;
        OnRound=1;
        ONE=0;
        SPACE=0;
      }else if (fastmod==0) {
        fastmod=1;
        SPACE=0;
      }else if (fastmod==1) {
        fastmod=0;
        SPACE=0;
      }
    }
  }
  function MakeEffect(x,y,type,value) {
    switch (type) {
      case 0:
        effect.x.push(x);
        effect.y.push(y);
        effect.Fx.push(x);
        effect.Fy.push(y);
        effect.type.push(type);
        effect.value.push(value);
        effect.Delay.push(50);
        break;
    }
  }
  function ActiveEffect() {
    var ctx = document.getElementById("MAIN").getContext("2d");
    for (var i = 0; i < effect.x.length; i++) {
      switch (effect.type[i]) {
        case 0:
          ctx.beginPath();
          ctx.font = "20px Arial";
          ctx.fillStyle = "#60AF60";
          ctx.textAlign = "left";
          ctx.fillText("+$"+effect.value[i],effect.x[i]-String(effect.value[i]).length*10,effect.y[i]-10);
          ctx.stroke();
          if (effect.Fy[i]-30<effect.y[i]) {
            effect.y[i]-=0.5;
          }else if (effect.Delay[i]>0) {
            effect.Delay[i]-=1;
          }else if(effect.Delay[i]<=0){
            effect.x.splice(i,1);
            effect.y.splice(i,1);
            effect.Fx.splice(i,1);
            effect.Fy.splice(i,1);
            effect.type.splice(i,1);
            effect.type.splice(i,1);
            effect.Delay.splice(i,1);
          }
          break;
      }
    }
  }
  function Rcollision(Rect1,Rect2){ //[x1,y1,x2,y2]
    AR={
      L : Rect1[0]*(Rect1[0]<=Rect1[2])+Rect1[2]*(Rect1[0]>Rect1[2]),
      R : Rect1[2]*(Rect1[0]<=Rect1[2])+Rect1[0]*(Rect1[0]>Rect1[2]),
      U : Rect1[1]*(Rect1[1]<=Rect1[3])+Rect1[3]*(Rect1[1]>Rect1[3]),
      D : Rect1[3]*(Rect1[1]<=Rect1[3])+Rect1[1]*(Rect1[1]>Rect1[3])
    }
    BR={
      L : Rect2[0]*(Rect2[0]<=Rect2[2])+Rect2[2]*(Rect2[0]>Rect2[2]),
      R : Rect2[2]*(Rect2[0]<=Rect2[2])+Rect2[0]*(Rect2[0]>Rect2[2]),
      U : Rect2[1]*(Rect2[1]<=Rect2[3])+Rect2[3]*(Rect2[1]>Rect2[3]),
      D : Rect2[3]*(Rect2[1]<=Rect2[3])+Rect2[1]*(Rect2[1]>Rect2[3])
    }
    if (AR.L<=BR.R&&AR.U<=BR.D&&AR.R>=BR.L&&AR.D>=BR.U) {
      return 1;
    }
    return 0;
  }
  function IsPointInCircle(ox,oy,or,px,py){
    return Math.sqrt((ox-px)**2+(oy-py))<=or;
  }
  function Rand(mod,max,min) {
    if(mod==0){
      return Math.random()*(max+1-min)+min;
    }else{
      return Math.floor(Math.random()*(max+1-min)+min);
    }
  }
  function DrawGear(D,x,y,size,mod) {
    var ctx = document.getElementById("MAIN").getContext("2d");
    if (mod==1||mod==undefined) {
      DrawGear(D,x,y,size,0)
    }
    ctx.strokeStyle='rgba(0,0,0,0)';
    if (mod==1||mod==undefined) {
      ctx.fillStyle='#808080';
    }else{
      ctx.fillStyle='#404040';
    }
    ctx.beginPath();
    ctx.arc(x,y,size/2.5-(mod||mod==undefined)*size/40,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    if (mod==1||mod==undefined) {
      ctx.strokeStyle='#808080';
    }else{
      ctx.strokeStyle='#404040';
    }
    ctx.lineWidth=size/4-(mod||mod==undefined)*2*size/40;
    for (var i = 0; i < 8; i++) {
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(move(D-45*i,x,y,size/2-(mod||mod==undefined)*size/40)[0],move(D-45*i,x,y,size/2-(mod||mod==undefined)*size/40)[1]);
      ctx.stroke();
    }
    ctx.strokeStyle='rgba(0,0,0,0)';
    ctx.fillStyle='#404040';
    ctx.beginPath();
    ctx.arc(x,y,size/6,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
  }
  function DrawTowerTap(select) {
    var ctx = document.getElementById("MAIN").getContext("2d");
    ctx.beginPath();
    ctx.fillStyle="#964B00";
    ctx.fillRect(80,450,600,200);
    ctx.stroke();
    ctx.beginPath();
    ctx.lineWidth=5;
    ctx.strokeStyle="#202020";
    ctx.rect(80,450,600,200);
    ctx.stroke();
    DrawTower(tower.type[select],tower.Upgrade[select],180,560,60,0);
    ctx.beginPath();
    ctx.font = "30px Arial";
    ctx.fillStyle = "#202020";
    ctx.textAlign = "center";
    ctx.fillText(tower_DNA.name[tower.type[select]],180,485);
    ctx.stroke();
    ctx.beginPath();
    ctx.fillStyle="#D00000";
    ctx.rect(80,600,200,50);
    ctx.fill();
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(280,450);
    ctx.lineTo(280,650);
    ctx.stroke();
    ctx.beginPath();
    ctx.font = "30px Arial";
    ctx.fillStyle = "#202020";
    ctx.textAlign = "center";
    if(TowerTapEvent!=1){
      ctx.fillText("Sell",180,637.5);
    }else {
      ctx.fillText("+$"+tower_DNA.cost[tower.type[select]]*7/10,180,637.5);
    }
    ctx.stroke();
  }
  function TowerTapClick(select) {
    TowerTapEvent=0;
    if (80<=mouse.x&&mouse.x<=280&&mouse.y>=600) {
      TowerTapEvent=1;
      if (mouse.click) {
        money+=tower_DNA.cost[tower.type[select]]*7/10;
        tower.x.splice(select,1);
        tower.y.splice(select,1);
        tower.type.splice(select,1);
        tower.Upgrade.splice(select,1);
        tower.R.splice(select,1);
        tower.D.splice(select,1);
        tower.AttackDelay.splice(select,1);
        SelectedTower=-1;
      }
    }
  }
  </script>
</head>
<body onload="draw()">
  <canvas id="MAIN" width="1000" height="650"></canvas>
</body
</html>
